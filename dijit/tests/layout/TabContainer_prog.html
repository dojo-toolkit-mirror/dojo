<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
	<title>dijit.layout.TabContainer Programmatic Test</title>

	<!-- only needed for test files: -->
	<style type="text/css">
		@import "../../../dojo/resources/dojo.css";
		@import "../css/dijitTests.css";
	</style>

	<!-- required: the default dijit theme: -->
	<link id="themeStyles" rel="stylesheet" href="../../../dijit/themes/claro/claro.css"/>

	<!-- required: dojo.js -->
	<script type="text/javascript" src="../../../dojo/dojo.js"
		djConfig="isDebug: true, parseOnLoad: false"></script>

	<!-- only needed for alternate theme testing: -->
	<script type="text/javascript" src="../_testCommon.js"></script>

	<!-- functions to help test -->
	<script type="text/javascript" src="../helpers.js"></script>

	<script type="text/javascript">
		dojo.require("doh.runner");
		dojo.require("dijit.dijit"); // optimize: load dijit layer
		dojo.require("dijit.layout.TabContainer");
        dojo.require("dijit.layout.ContentPane");

		var tab = 1;

		var tc, cp;
		function create(initialTabs, id){
			tc = new dijit.layout.TabContainer({id:id, style:'height:200px;width:500px;'});
			dojo.place(tc.domNode, dojo.byId('main'), "after");

			for(var i=0; i<initialTabs; i++){
				cp = new dijit.layout.ContentPane({title: 'Tab ' + tab});
				cp.domNode.innerHTML = "Contents of Tab " + tab++;
				tc.addChild(cp);
			}

			tc.startup();
        }

        function addTab(){
			cp = new dijit.layout.ContentPane({title: 'Tab' + tab});
			cp.domNode.innerHTML = "Contents of Tab " + tab++;
			tc.addChild(cp);
        }
		
		dojo.addOnLoad(function(){
			doh.register("Tab container programmatic",[
				{
					name: "createEmptyTabContainer",
					timeout: 2000,
					runTest: function(t){
						create(0, 'emptyTC');				
						
						var emptyTC = dijit.byId("emptyTC");
						var children = emptyTC.getChildren();
						doh.is(0, children.length);
						doh.t(isVisible(emptyTC));
						
						var pos = dojo.position(emptyTC.domNode);
						var heightDiff = 200 - pos.h;
						var widthDiff = 500 - pos.w;
						doh.t(-0.01 < heightDiff && heightDiff < 0.01);
						doh.t(-0.01 < widthDiff && widthDiff < 0.01);
					}
				},
				{
					name: "addTabToEmptyTabContainer",
					timeout: 2000,
					runTest: function(t){
						addTab();							

						var tc = dijit.byId("emptyTC");
						var children = tc.getChildren();
						doh.is(1, children.length);
						doh.is("Tab1", children[0].title);
						doh.is("Contents of Tab 1", tc.selectedChildWidget.domNode.innerHTML);

						doh.t(isVisible(tc.tablist.containerNode.childNodes[0]));
					}
				},
				{
					name: "add2ndTabToEmptyTabContainer",
					timeout: 3000,
					runTest: function(t){
						var tc = dijit.byId("emptyTC");
						addTab();							
						tc.selectChild(tc.getChildren()[1]);							
						var children = tc.getChildren();
						doh.is(2, children.length);
						doh.is("Tab2", children[1].title);
						doh.is("Contents of Tab 2", tc.selectedChildWidget.domNode.innerHTML);
						
						doh.t(isVisible(tc.tablist.containerNode.childNodes[1]));
					}
				},
				{
					name: "remove2ndTabToEmptyTabContainer",
					timeout: 3000,
					runTest: function(t){
						var tc = dijit.byId("emptyTC");
						tc.removeChild(tc.getChildren()[1]);							
						var children = tc.getChildren();
						doh.is(1, children.length);
						doh.is("Tab1", children[0].title);
						doh.is("Contents of Tab 1", tc.selectedChildWidget.domNode.innerHTML);
					}
				},
				{
					name: "createTabContainerWith2Tabs",
					timeout: 4000,
					runTest: function(t){
						var d = new doh.Deferred();
						
						create(2, 'tc2');							

						var tc = dijit.byId("tc2");
						dijit.scrollIntoView(tc.domNode);
						
						var children = tc.getChildren();
						doh.is(2, children.length);
						doh.is("Tab 3", children[0].title);
						doh.is("Contents of Tab 3", tc.selectedChildWidget.domNode.innerHTML);
						doh.t(isVisible(tc), "Tab container is not visible");
							
						var pos = dojo.position(tc.domNode);
						var heightDiff = 200 - pos.h;
						var widthDiff = 500 - pos.w;
						doh.t(-0.01 < heightDiff && heightDiff < 0.01, "heightDiff: " + heightDiff);
						doh.t(-0.01 < widthDiff && widthDiff < 0.01, "widthDiff: " + widthDiff);
					}
				},
				{
					name: "addTabToTabContainerWith2Tabs",
					timeout: 2000,
					runTest: function(t){
						var d = new doh.Deferred();
						
						addTab();
					
						var tc = dijit.byId("tc2");
						var children = tc.getChildren();
						doh.is(3, children.length);
						doh.is("Tab 3", children[0].title);
						doh.is("Contents of Tab 3", tc.selectedChildWidget.domNode.innerHTML);
							
						dijit.scrollIntoView(tc.domNode);
						doh.t(isVisible(tc.tablist.containerNode.childNodes[2]), "new tab is not visible");
					}
				},
				{
					name: "select2ndTabInTabContainerWith2Tabs",
					timeout: 2000,
					runTest: function(t){
						var tc = dijit.byId("tc2");
						tc.selectChild(tc.getChildren()[1]);							
						var children = tc.getChildren();
						doh.is(3, children.length);
						doh.is("Tab 4", children[1].title);
						doh.is("Contents of Tab 4", tc.selectedChildWidget.domNode.innerHTML);
					}
				},
				{
					name: "remove2ndTabInTabContainerWith2Tabs",
					timeout: 2000,
					runTest: function(t){
							var tc = dijit.byId("tc2");
							tc.removeChild(tc.getChildren()[1]);							
							var children = tc.getChildren();
							doh.is(2, children.length);
							doh.is("Contents of Tab 3", tc.selectedChildWidget.domNode.innerHTML);
					}
				}
			]);			
			doh.run();
		});
	</script>
</head>
<body class="claro">
	<h2 class="testTitle">dijit.layout.TabContainer programmatic test</h2>
	<div id='main'>
	</div>

	<button id="createEmpty" onclick="create(0, 'emptyTC')">create empty tab container</button>
	<button id="createWith2Tabs" onclick="create(2, 'tc2')">create tab container w/2 tabs</button>

	<button id="select2ndTab" onclick="tc.selectChild(tc.getChildren()[1]);">select second tab</button>
	<button id="remove2ndTab" onclick="tc.removeChild(tc.getChildren()[1]);">remove second tab</button>
	<button id="addTab" onclick="addTab();">add tab</button>
</body>
</html>
