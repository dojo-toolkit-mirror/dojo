<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN"
		"http://www.w3.org/TR/html4/strict.dtd">
<html>
	<head>
		<title>doh.robot Spinner Test</title>

		<style>
			@import "../../../../util/doh/robot/robot.css";
		</style>

		<!-- required: dojo.js -->
		<script type="text/javascript" src="../../../../dojo/dojo.js"
			djConfig="isDebug: true, parseOnLoad: true"></script>

		<script type="text/javascript">
			dojo.require("dijit.dijit"); // optimize: load dijit layer
			dojo.require("dijit.robotx");

			dojo.addOnLoad(function(){
				var spin1;
				var spin2;
				var spin3;
				var spinnerIds = ["integerspinner1", "integerspinner2", "integertextbox3", "realspinner1"];
				var safeClick;
				var delta=1; // redefine with doh.robot.mouseWheelSize when it is available
				doh.robot.initRobot('../test_Spinner.html');
				
				// focus handlers for noticing tab/shift+tab navigation
				var focusCountZ = 0;
				var blurCountZ = 0;
				var countFocus = function(){
					focusCountZ++;
				}
				var countBlur = function(){
					blurCountZ++;
				}
				var focusConnect;
				var blurConnect;
				var tabFocusSetup = function(inSpinnerId){
					var spinner = dijit.byId(inSpinnerId);
					focusCountZ = 0;
					blurCountZ = 0;
					focusConnect = spinner.connect(spinner.focusNode, "onfocus", countFocus);
					blurConnect = spinner.connect(spinner.focusNode, "onblur", countBlur);
				}
				
				// setup to test manipulation of spinner via keystrokes.
				var results;
				var strokeIndex = 0;
				var noteConnect;
				function noteChanges(){
					results[strokeIndex].actual = spinner.attr('value');
					strokeIndex++;
				}
				function keyStrokeSetup(inSpinnerId){
					var spinner = dijit.byId(inSpinnerId);
					results = populateExpected(spinner);
					strokeIndex = 0;
					noteConnect = spinner.connect(spinner.focusNode, "onkeypress", function(){
						results[strokeIndex].actual = spinner.attr('value');
						strokeIndex++;
					});
				}

				// use spinner api to calculate values for a set of keystrokes.
				var populateExpected = function(/*Spinner Widget*/inSpinner){
					var initVal = inSpinner.attr('value');
					var eVals = [];
					var newVal;
					
					// The values expected by pressing HOME, right arrow five times,
					// PgUp twice, PgDn, up arrow twice, down arrow once,
					// left arrow once, and END.
					if(inSpinner.constraints.min){
						inSpinner.attr('value', inSpinner.constraints.min);
						newVal = inSpinner.attr('value');
					}else{
						newVal = inSpinner.attr('value');
					}
					eVals.push({stroke: "HOME", expected: newVal});
					// UP 5 times
					for(var i = 0; i < 5; i++){
						newVal = inSpinner.adjust(newVal, inSpinner.smallDelta);
						inSpinner.attr('value', newVal);
						newVal = inSpinner.attr('value');
						eVals.push({stroke: "UP", expected: newVal});					
					}
					// PgUp twice
					for(var i = 0; i < 2; i++){
						newVal = inSpinner.adjust(newVal, inSpinner.largeDelta);
						inSpinner.attr('value', newVal);
						newVal = inSpinner.attr('value');
						eVals.push({stroke: "PgUp", expected: newVal});					
					}
					// PgDn once.
					newVal = inSpinner.adjust(newVal, -inSpinner.largeDelta);
					inSpinner.attr('value', newVal);
					newVal = inSpinner.attr('value');
					eVals.push({stroke: "PgDn", expected: newVal});					
					// DOWN
					newVal = inSpinner.adjust(newVal, -inSpinner.smallDelta);
					inSpinner.attr('value', newVal);
					newVal = inSpinner.attr('value');
					eVals.push({stroke: "DOWN", expected: newVal});					
					// END
					if(inSpinner.constraints.max){
						inSpinner.attr('value', inSpinner.constraints.max);
						newVal = inSpinner.attr('value');
					}else{
						newVal = inSpinner.attr('value');
					}
					eVals.push({stroke: "END", expected: newVal});
					
					// reset <inSpinner> back to its initial value, and return
					inSpinner.attr('value', initVal);
					return eVals;
				}
				
				// common robot TAB-focus test function.
				var a11yTabFocus = function(inSpinnerId){
					var d = new doh.Deferred();
					var spinner = dijit.byId(inSpinnerId);
					// insure a known focus starting point within document before key presses.
					doh.robot.mouseMoveAt(spinner.focusNode, 500);
					doh.robot.mouseClick({left:true}, 100);
					// Shift-tab away, tab to, tab away, shift-tab back.
					doh.robot.keyPress(dojo.keys.TAB, 100, {shift:true});
					doh.robot.keyPress(dojo.keys.TAB, 100);
					doh.robot.keyPress(dojo.keys.TAB, 100);
					doh.robot.keyPress(dojo.keys.TAB, 100, {shift:true});
					var checkGotFocus = function(){
						spinner.disconnect(focusConnect);
						spinner.disconnect(blurConnect);
						doh.assertEqual(3, focusCountZ, "# of times focused (" + spinner.id + ")");
						doh.assertEqual(2, blurCountZ, "# of times lost focus (" + spinner.id + ")");
					};
					doh.robot.sequence(d.getTestCallback(checkGotFocus), 1100);
					return d;
				}
				
				// common robot keystroek test function.
				var a11yKeystrokeTest = function(inSpinnerId){
					var d = new doh.Deferred();
					var spinner = dijit.byId(inSpinnerId);
					var initVal = spinner.attr('value');

					doh.robot.mouseMoveAt(spinner.focusNode, 500);
					doh.robot.mouseClick({left:true}, 100);
					doh.robot.keyPress(dojo.keys.HOME, 100);
					doh.robot.keyPress(dojo.keys.UP_ARROW, 100);
					doh.robot.keyPress(dojo.keys.UP_ARROW, 100);
					doh.robot.keyPress(dojo.keys.UP_ARROW, 100);
					doh.robot.keyPress(dojo.keys.UP_ARROW, 100);
					doh.robot.keyPress(dojo.keys.UP_ARROW, 100);
					doh.robot.keyPress(dojo.keys.PAGE_UP, 100);
					doh.robot.keyPress(dojo.keys.PAGE_UP, 100);
					doh.robot.keyPress(dojo.keys.PAGE_DOWN, 100);
					doh.robot.keyPress(dojo.keys.DOWN_ARROW, 100);
					doh.robot.keyPress(dojo.keys.END, 100);
					var testPresses = function(){
						spinner.disconnect(noteConnect);
						spinner.attr('value', initVal);
						for(var i = 0; i < results.length; i++){
							var aResult = results[i];
							if(!(isNaN(aResult.expected) && isNaN(aResult.actual))) {
								doh.is(aResult.expected, aResult.actual, aResult.stroke);
							}
						}
					};
					doh.robot.sequence(d.getTestCallback(testPresses), 1600);
					return d;
				}

				doh.register("setUp",{
					name: "setUp",
					timeout: 15000,
					setUp:function(){
						spin1=dijit.byId('integerspinner1');
						spin2=dijit.byId('integerspinner2');
						spin3=dijit.byId('realspinner1');
						safeClick=dojo.byId('form1');
					},
					runTest: function(){
						// assert onChange not fired
						doh.is("not fired yet!",dojo.byId('oc1').value);
						doh.is(1,spin1.smallDelta);
						var s=": 900\n"
						+"integerspinner1: 900\n"
						+": not fired yet!\n"
						+": 1,000\n"
						+"integerspinner2: 1000\n"
						+": \n"
						+"integertextbox3: \n"
						+": 1.0\n"
						+"realspinner1: 1\n";
						doh.is(s, dojo.doc.displayData().replace(/[a-zA-Z0-9_]*_displayed_/g, ""));
					}
				});

				doh.register("setvaluetest",{
					name: "valid",
					runTest:function(){
						spin1.attr('value', 400);
						doh.is(400, spin1.focusNode.value);
						doh.is(true, spin1.isValid());

					}
				});

				doh.register("setvaluetest",{
					name: "null_required",
					runTest:function(){
						spin1.attr('value', null);
						doh.is('', spin1.focusNode.value);
						doh.is(false, spin1.isValid());
						doh.is(true, isNaN(spin1.attr('value')));
					}
				});

				doh.register("setvaluetest",{
					name: "null_notrequired",
					runTest:function(){
						spin1.attr('value', null);
						spin1.attr('required',false);
						doh.is('', spin1.focusNode.value);
						doh.is(true, spin1.isValid());
						doh.is(true, isNaN(spin1.attr('value')));
					},
					tearDown:function(){
						spin1.attr('required',true);
						spin1.attr('value', 900);
					}
				});

				doh.register("arrowButton",{
					name: "spinner1_typematic",
					timeout: 15000,
					setUp:function(){
						spin1.attr('value', 900);
					},
					runTest: function(){
						// test typematic
						var d=new doh.Deferred();
						doh.robot.mouseMoveAt(spin1.downArrowNode, 500);
						doh.robot.mousePress({left:true,  middle:false,  right:false}, 3);
						doh.robot.mouseRelease({left:true,  middle:false,  right:false}, 11000);
						doh.robot.sequence(function(){
							if(spin1.attr('value')<=800){
								d.callback(true);
							}else{
								d.errback(new Error('Error in typematic test. Expected <=800, got '+spin1.attr('value')));
							}
						}, 1000);
						return d;
					}
				});

				doh.register("arrowButton",{
					name: "spinner1_max",
					timeout: 15000,
					setUp:function(){
						spin1.attr('value', 1549);
					},
					runTest: function(){
						// test max with arrow button
						var d=new doh.Deferred();
						// press once: should move up
						doh.robot.mouseMoveAt(spin1.upArrowNode, 500);
						doh.robot.mouseClick({left:true,  middle:false,  right:false}, 3);
						doh.robot.mouseMoveAt(safeClick, 500, 100, 0, 0);
						doh.robot.mouseClick({left:true,  middle:false,  right:false}, 3);
						doh.robot.sequence(d.getTestErrback(function(){
							doh.is(1550,spin1.attr('value'));
							doh.is("1,550",spin1.focusNode.value);
							doh.is("1550",dojo.byId('oc1').value);
							doh.is(true,spin1.isValid());
							// press again: shouldn't move
							doh.robot.mouseMoveAt(spin1.upArrowNode, 500);
							doh.robot.mouseClick({left:true,  middle:false,  right:false}, 3);
							doh.robot.mouseMoveAt(safeClick, 500, 100, 0, 0);
							doh.robot.mouseClick({left:true,  middle:false,  right:false}, 3);
							doh.robot.sequence(d.getTestCallback(function(){
								doh.is(1550,spin1.attr('value'));
								doh.is("1,550",spin1.focusNode.value);
								doh.is("1550",dojo.byId('oc1').value);
								doh.is(true,spin1.isValid());
							}),500);
						}),500);

						return d;
					}
				});
				doh.register("arrowButton",{
					name: "spinner1_min",
					timeout: 15000,
					setUp:function(){
						spin1.attr('value', 1);
					},
					runTest: function(){
						// test min with arrow button
						var d=new doh.Deferred();
						// press once: should move up
						doh.robot.mouseMoveAt(spin1.downArrowNode, 500);
						doh.robot.mouseClick({left:true,  middle:false,  right:false}, 3);
						doh.robot.mouseMoveAt(safeClick, 500, 100, 0, 0);
						doh.robot.mouseClick({left:true,  middle:false,  right:false}, 3);
						doh.robot.sequence(d.getTestErrback(function(){
							doh.is(0,spin1.attr('value'));
							doh.is("0",spin1.focusNode.value);
							doh.is("0",dojo.byId('oc1').value);
							doh.is(true,spin1.isValid());
							// press again: can move since no min
							doh.robot.mouseMoveAt(spin1.downArrowNode, 500);
							doh.robot.mouseClick({left:true,  middle:false,  right:false}, 3);
							doh.robot.mouseMoveAt(safeClick, 500, 100, 0, 0);
							doh.robot.mouseClick({left:true,  middle:false,  right:false}, 3);
							doh.robot.sequence(d.getTestCallback(function(){
								doh.is(-1,spin1.attr('value'));
								doh.is("-1",spin1.focusNode.value);
								doh.is("-1",dojo.byId('oc1').value);
								doh.is(true,spin1.isValid());
							}),500);
						}),500);

						return d;
					}
				});
				doh.register("arrowButton",{
					name: "spinner1_invalid",
					timeout: 15000,
					runTest: function(){
						// assert invalid works
						var d=new doh.Deferred();
						doh.robot.mouseMoveAt(spin1.focusNode,500);
						doh.robot.mouseClick({left:true},500);
						doh.robot.sequence(function(){
							spin1.focusNode.value="";
						},500);
						doh.robot.typeKeys("0.5",500,300);
						doh.robot.sequence(d.getTestCallback(function(){
							doh.is(false,spin1.isValid());
						}),500);
						return d;
					},
					tearDown:function(){
						spin1.attr('value',1);
					}
				});

				doh.register("arrowButton",
				{
					name:"spinner1",
					timeout:5500,
					setUp:function(){
						spin1.attr('value', 900);
					},
					runTest:function(){
						// get the mouse's delta
						// note that Spinner spins backwards!
						delta=-doh.robot.mouseWheelSize;
						var d=new doh.Deferred();
						doh.robot.mouseMoveAt(spin1.domNode, 1000);
						doh.robot.mouseClick({left:true}, 500);
						// wheel up 10 times
						// this should increase the value by 10
						// takes 100ms/click
						doh.robot.mouseWheel(-10, 1000, 1000);
						doh.robot.sequence(function(){
							var v=spin1.attr('value');
							if(v==(900+10*delta)){
								d.callback(true);
							}else{
								d.errback(new Error("spinner 1: wrong value, expected "+(900+10*delta)+", got "+spin1.attr('value')));							}
						}, 1000);
						return d;
					}
				});

				doh.register("a11y",
				{
					name:"spinner2",
					timeout:5500,
					setUp:function(){
						spin2.attr('value', 1000);
					},
					runTest:function(){
						// test custom delta with mouse wheel
						// it should increment 10 per mouse wheel
						var d=new doh.Deferred();
						doh.robot.mouseMoveAt(spin2.domNode, 1000);
						doh.robot.mouseClick({left:true}, 500);
						// wheel down 9 times
						// this should decrease the value by 90
						// takes 100ms/click
						doh.robot.mouseWheel(9, 1000, 900);
						doh.robot.sequence(function(){
							if(spin2.attr('value')==(1000-90*delta)){
								d.callback(true);
							}else{
								d.errback(new Error("spinner 2: wrong value, expected "+(1000-90*delta)+", got "+spin2.attr('value')));
							}
						}, 1000);
						return d;
					}
				});

				doh.register("a11y",{
					name: "spinner2_typematic",
					timeout: 15000,
					setUp:function(){
						spin2.attr('value', 900);
					},
					runTest: function(){
						// test typematic
						var d=new doh.Deferred();
						doh.robot.mouseMoveAt(spin2.focusNode, 500);
						doh.robot.mouseClick({left:true,  middle:false,  right:false}, 3);
						doh.robot.keyDown(dojo.keys.DOWN_ARROW, 500);
						doh.robot.keyUp(dojo.keys.DOWN_ARROW, 5000);
						doh.robot.sequence(function(){
							if(spin2.attr('value')<=700){
								d.callback(true);
							}else{
								d.errback(new Error('Error in typematic test. Expected <=800, got '+spin2.attr('value')));
							}
						}, 1000);
						return d;
					}
				});

				doh.register("a11y",{
					name: "spinner2_max",
					timeout: 15000,
					setUp:function(){
						spin2.attr('value', 1549);
					},
					runTest: function(){
						// test max with arrow key
						var d=new doh.Deferred();
						// press once: should move up
						doh.robot.mouseMoveAt(spin2.focusNode, 500);
						doh.robot.mouseClick({left:true,  middle:false,  right:false}, 3);
						doh.robot.keyPress(dojo.keys.UP_ARROW,500);
						doh.robot.sequence(d.getTestErrback(function(){
							doh.is(1550,spin2.attr('value'));
							doh.is("1550",spin2.focusNode.value);
							doh.is(true,spin2.isValid());
							// press again: shouldn't move
							doh.robot.mouseMoveAt(spin2.focusNode, 500);
							doh.robot.mouseClick({left:true,  middle:false,  right:false}, 3);
							doh.robot.keyPress(dojo.keys.UP_ARROW,500);
							doh.robot.sequence(d.getTestCallback(function(){
								doh.is(1550,spin2.attr('value'));
								doh.is("1550",spin2.focusNode.value);
								doh.is(true,spin2.isValid());
							}),500);
						}),500);

						return d;
					}
				});

				doh.register("a11y",{
					name: "spinner2_min",
					timeout: 15000,
					setUp:function(){
						spin2.attr('value', 10);
					},
					runTest: function(){
						// test min with arrow key
						var d=new doh.Deferred();
						// press once: should move up
						doh.robot.mouseMoveAt(spin2.focusNode, 500);
						doh.robot.mouseClick({left:true,  middle:false,  right:false}, 3);
						doh.robot.keyPress(dojo.keys.DOWN_ARROW,500);
						doh.robot.sequence(d.getTestErrback(function(){
							doh.is(9,spin2.attr('value'));
							doh.is("9",spin2.focusNode.value);
							doh.is(true,spin2.isValid());
							// press again: shouldn't move
							doh.robot.mouseMoveAt(spin2.focusNode, 500);
							doh.robot.mouseClick({left:true,  middle:false,  right:false}, 3);
							doh.robot.keyPress(dojo.keys.DOWN_ARROW,500);
							doh.robot.sequence(d.getTestCallback(function(){
								doh.is(9,spin2.attr('value'));
								doh.is("9",spin2.focusNode.value);
								doh.is(true,spin2.isValid());
							}),500);
						}),500);

						return d;
					}
				});

				doh.register("a11y",{
					name: "spinner2_invalid",
					timeout: 15000,
					runTest: function(){
						// assert invalid works
						var d=new doh.Deferred();
						doh.robot.mouseMoveAt(spin2.focusNode,500);
						doh.robot.mouseClick({left:true},500);
						doh.robot.sequence(function(){
							spin2.focusNode.value="";
						},500);
						doh.robot.typeKeys("0.5",500,300);
						doh.robot.sequence(d.getTestCallback(function(){
							doh.is(false,spin2.isValid());
						}),500);
						return d;
					},
					tearDown:function(){
						spin2.attr('value',1);
					}
				});
				doh.register("mouseWheel",
				{
					name:"spinner3",
					timeout:5500,
					setUp:function(){
						spin3.attr('value', 1.0);
					},
					runTest:function(){
						// test real number spinner with mouse wheel
						// it should increment 0.1 per mouse wheel
						var d=new doh.Deferred();
						doh.robot.mouseMoveAt(spin3.domNode, 1000);
						doh.robot.mouseClick({left:true}, 500);
						// wheel up 10
						// this should increase the value by 1.0
						// takes 100ms/click
						doh.robot.mouseWheel(-10, 1000, 1000); 
						doh.robot.sequence(function(){
							if(spin3.attr('value')==(1.0+1.0*delta)){
								d.callback(true);
							}else{
								d.errback(new Error("spinner 3: wrong value, expected "+(1.0+1.0*delta)+", got "+spin3.attr('value')));
							}
						}, 1000);
						return d;
					}
				});


				doh.register("mouseWheel",{
					name: "spinner3_max",
					timeout: 15000,
					setUp:function(){
						spin3.attr('value', 155-0.1*delta);
					},
					runTest: function(){
						// test max with arrow key
						var d=new doh.Deferred();
						// press once: should move up
						doh.robot.mouseMoveAt(spin3.focusNode, 500);
						doh.robot.mouseClick({left:true,  middle:false,  right:false}, 3);
						// wheel up 1; this will increase the value by delta
						doh.robot.mouseWheel(-1, 500, 1);
						doh.robot.sequence(d.getTestErrback(function(){
							doh.is(155.0,spin3.attr('value'));
							doh.is("155.0",spin3.focusNode.value);
							doh.is(true,spin3.isValid());
							// press again: shouldn't move
							doh.robot.mouseMoveAt(spin3.focusNode, 500);
							doh.robot.mouseClick({left:true,  middle:false,  right:false}, 3);
							// wheel up 1; this will increase the value by delta
							doh.robot.mouseWheel(-1, 500, 1);
							doh.robot.sequence(d.getTestCallback(function(){
								doh.is(155.0,spin3.attr('value'));
								doh.is("155.0",spin3.focusNode.value);
								doh.is(true,spin3.isValid());
							}),500);
						}),500);

						return d;
					}
				});

				doh.register("mouseWheel",{
					name: "spinner3_min",
					timeout: 15000,
					setUp:function(){
						spin3.attr('value', -10.9+0.1*delta);
					},
					runTest: function(){
						// test min with arrow key
						var d=new doh.Deferred();
						// press once: should move up
						doh.robot.mouseMoveAt(spin3.focusNode, 500);
						doh.robot.mouseClick({left:true,  middle:false,  right:false}, 3);
						doh.robot.keyPress(dojo.keys.DOWN_ARROW,500);
						doh.robot.mouseWheel(1, 500, 1);
						doh.robot.sequence(d.getTestErrback(function(){
							doh.is(-10.9,spin3.attr('value'));
							doh.is("-10.9",spin3.focusNode.value);
							doh.is(true,spin3.isValid());
							// press again: shouldn't move
							doh.robot.mouseMoveAt(spin3.focusNode, 500);
							doh.robot.mouseClick({left:true,  middle:false,  right:false}, 3);
							doh.robot.mouseWheel(1, 500, 1);
							doh.robot.sequence(d.getTestCallback(function(){
								doh.is(-10.9,spin3.attr('value'));
								doh.is("-10.9",spin3.focusNode.value);
								doh.is(true,spin3.isValid());
							}),500);
						}),500);

						return d;
					}
				});

				doh.register("mouseWheel",{
					name: "spinner3_invalid",
					timeout: 15000,
					runTest: function(){
						// assert invalid works
						var d=new doh.Deferred();
						doh.robot.mouseMoveAt(spin3.focusNode,500);
						doh.robot.mouseClick({left:true},500);
						doh.robot.sequence(function(){
							spin3.focusNode.value="";
						},500);
						doh.robot.typeKeys("0.a",500,300);
						doh.robot.sequence(d.getTestCallback(function(){
							doh.is(false,spin3.isValid());
						}),500);
						return d;
					},
					tearDown:function(){
						spin3.attr('value',1);
					}
				});

				doh.register("tearDown",{
					name:"tearDown",
					runTest:function(){
						var spin1Value=900+10*delta;
						var s=": "+spin1Value+"\n"
						+"integerspinner1: "+spin1Value+"\n"
						+": "+spin1Value+"\n"
						+": 1\n"
						+"integerspinner2: 1\n"
						+": \n"
						+"integertextbox3: \n"
						+": 1.0\n"
						+"realspinner1: 1\n";
						doh.is(s, dojo.doc.displayData().replace(/[a-zA-Z0-9_]*_displayed_/g, ""));
					}
				});
				
				// aria role and properties tests.
				doh.register("a11yAria",
				[
					function ariaRole(){
						for(i=0; i<spinnerIds.length; i++){
							var spinner = dijit.byId(spinnerIds[i]);
							doh.is(dijit.getWaiRole(spinner.focusNode), "spinbutton", spinner.id + ": aria role (spinbutton)");
						}
					},
					
					// test aria valuemin, valuemax, valuenow.
					function ariaValue(){
						for(var i=0; i<spinnerIds.length; i++){
							var spinner = dijit.byId(spinnerIds[i]);
							var min = -9999;
							var max = 9999;
							if(spinner.constraints.min){
								min = spinner.constraints.min;
								doh.is(dijit.getWaiState(spinner.focusNode, "valuemin"), min, spinner.id + ": aria-valuemin");
							}
							if(spinner.constraints.max){
								max = spinner.constraints.max;
								doh.is(dijit.getWaiState(spinner.focusNode, "valuemax"), max, spinner.id + ": aria-valuemax");
							}
							// set spinner to some random value in its range.
							var setVal = Math.floor((Math.random() * (max - min)) + min);
							spinner.attr('value', setVal);
							doh.is(dijit.getWaiState(spinner.focusNode, "valuenow"), spinner.attr('value'), spinner.id + ": aria-valuenow");
						}
					}
				]);

					
					// test "null" aria-valuenow
/* Remove null aria-valuenow test until #7866 is resolved
					function nullAriaValueNow(){
						for(var i=0; i<spinnerIds.length; i++){
							var spinner = dijit.byId(spinnerIds[i]);
							var initVal = spinner.attr('value');
							spinner.attr('value', null);
							var spinnerVal = spinner.attr('value');
							var nowVal = dijit.getWaiState(spinner.focusNode, "valuenow");
							var invalid = dijit.getWaiState(spinner.focusNode, "invalid");
							spinner.attr('value', initVal);
							doh.t(invalid, spinner.id + ": aria-invalid");
							if(!(isNaN(spinnerVal) && isNaN(nowVal))){
								doh.is(spinnerVal, nowVal, spinner.id + ": null aria-valuenow");
							}
						}
					} 
*/
	
				// a11y tab focus tests (robot)
				doh.register("a11yTabFocus",
				[
					{
						name:"integerspinner1TabFocus",
						timeout:4000,
						setUp:function(){
							tabFocusSetup("integerspinner1");
						},
						runTest:function(){
							return a11yTabFocus("integerspinner1");
						}
					},
					{
						name:"integerspinner2TabFocus",
						timeout:4000,
						setUp:function(){
							tabFocusSetup("integerspinner2");
						},
						runTest:function(){
							return a11yTabFocus("integerspinner2");
						}
					},
					{
						name:"integertextbox3TabFocus",
						timeout:4000,
						setUp:function(){
							tabFocusSetup("integertextbox3");
						},
						runTest:function(){
							return a11yTabFocus("integertextbox3");
						}
					}/*,
					// this test fails for since there is nothing to focus on below 'realspinner1'
					{
						name:"realspinner1TabFocus",
						timeout:4000,
						setUp:function(){
							tabFocusSetup("realspinner1");
						},
						runTest:function(){
							return a11yTabFocus("realspinner1");
						}
					}*/
				]);
				
				// a11y keystroke tests
				doh.register("a11yKeystrokes",
				[
					{
						name:"integerspinner1Keystrokes",
						timeout:4000,
						setUp:function(){
							keyStrokeSetup("integerspinner1");
						},
						runTest:function(){
							return a11yKeystrokeTest("integerspinner1");
						}
					},
					{
						name:"integerspinner2Keystrokes",
						timeout:4000,
						setUp:function(){
							keyStrokeSetup("integerspinner2");
						},
						runTest:function(){
							return a11yKeystrokeTest("integerspinner2");
						}
					},
					{
						name:"integertextbox3Keystrokes",
						timeout:4000,
						setUp:function(){
							keyStrokeSetup("integertextbox3");
						},
						runTest:function(){
							return a11yKeystrokeTest("integertextbox3");
						}
					},
					{
						name:"realspinner1Keystrokes",
						timeout:4000,
						setUp:function(){
							keyStrokeSetup("realspinner1");
						},
						runTest:function(){
							return a11yKeystrokeTest("realspinner1");
						}
					}
				]);
				
				doh.run();
			});
		</script>
	</head>
</html>
