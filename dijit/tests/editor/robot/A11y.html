<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN"
		"http://www.w3.org/TR/html4/strict.dtd">
<html>
	<head>
		<title>doh.robot Editor A11Y Test</title>

		<style>
			@import "../../../../util/doh/robot/robot.css";
		</style>

		<!-- required: dojo.js -->
		<script type="text/javascript" src="../../../../dojo/dojo.js"
			djConfig="isDebug: true, parseOnLoad: true"></script>

		<!-- functions to help test -->
		<script type="text/javascript" src="../../helpers.js"></script>

		<script type="text/javascript">
			dojo.require("dijit.dijit"); // optimize: load dijit layer
			dojo.require("dijit.robotx");

			// This page tests that the editor's value won't be lost if the user
			// accidentlly navigates to a different page, and then returns to the
			// page w/the editor by pressing the back button.

			dojo.addOnLoad(function(){
				doh.robot.initRobot('../test_Editor.html');

				// For some reason the meta key (meta-a for selection, meta-b for bold, etc) isn't working
				// on mac... use ctrl- instead, just like on windows. (#9553)
				var metaKey = {ctrl: true}

				doh.register("keyboard shortcuts", [
					{
						name: "correct input",
						timeout: 10000,
						runTest: function(){
							var d = new doh.Deferred();

							var editor1 = dijit.byId("editor1");

							// Set contents of editor1
							doh.robot.sequence(function(){
								editor1.focus();
							}, 500);
							doh.robot.keyPress("a", 500, metaKey);	// select all
							doh.robot.typeKeys("hello ", 500);		// and erase (by typing something new)
							doh.robot.keyPress("b", 500, metaKey);	// start bold
							doh.robot.typeKeys("bold", 500);
							doh.robot.keyPress("b", 500, metaKey);	// stop bold
							doh.robot.typeKeys(" and ", 500);
							doh.robot.keyPress("i", 500, metaKey);	// start italic
							doh.robot.typeKeys("exciting", 500);
							doh.robot.keyPress("i", 500, metaKey);	// stop italic
							doh.robot.typeKeys(" new world.", 500);
							
							doh.robot.sequence(d.getTestCallback(function(){
								// Get the value and try to do some normalization to make all browsers look
								// the same.   Would be nice if we didn't need this, the normalization should
								// probably happen as pre and post filters on the editor
								var val = editor1.attr('value').
										replace('<br />', '').
										replace(/^<p>/, '').
										replace(/<\/p>$/, '').
										replace(/em>/g, "i>").
										replace(/strong>/g, "b>");
								doh.is("hello <b>bold</b> and <i>exciting</i> new world.", val);
							}), 500);

							return d;
						}
					}
				]);

				doh.run();
			});
		</script>
	</head>
</html>