<!DOCTYPE html>
<html style="height:100%;">
	<head>
		<title>The Dojo Unit Test Harness, $Rev: 25266 $</title>

		<script type="text/javascript">
			// workaround for bug in Safari 3.	See #7189
			if (/3[\.0-9]+ Safari/.test(navigator.appVersion))
			{
				window.console = {
					origConsole: window.console,
						log: function(s){
						this.origConsole.log(s);
					},
					info: function(s){
						this.origConsole.info(s);
					},
					error: function(s){
						this.origConsole.error(s);
					},
					warn: function(s){
						this.origConsole.warn(s);
					}
				};
			}
		</script>

		<script type="text/javascript">
			(function(){
				var
					boot=
						// zero to many scripts to load a configuration and/or loader.
						// i.e. path-to-util/doh/runner.html?boots=path-to/config.js,path-to/require.js
						["../../dojo/dojo.js"],

					standardDojoBoot= boot,
			
					test= 
						// zero to many AMD modules and/or URLs to load; provided by csv URL query parameter="test"
						// For example, the URL...
						//
						//		 path-to-util/doh/runner.html?test=doh/selfTest,my/path/test.js
						//
						// ...will load...
						//
						//	 * the AMD module doh/selfTest
						//	 * the plain old Javascript resource my/path/test.js
						//
						["dojo/tests/module"],
			
					paths = 
						// zero to many path items to pass to the AMD loader; provided by semicolon separated values 
						// for URL query parameter="paths"; each path item has the form <from-path>,<to-path>
						// i.e. path-to-util/doh/runner.html?paths=my/from/path,my/to/path;my/from/path2,my/to/path2
						{},
						
					dohPlugins = 
						// Semicolon separated list of files to load before the tests.
						// Idea is to override aspects of DOH for reporting purposes.
						"",

					breakOnError = 
						// boolean; instructs doh to call the debugger upon a test failures; this can be helpful when
						// trying to isolate exactly where the test failed
						false,

					async = 
						// boolean; config require.asyc==true before loading boot; this will have the effect of making
						// version 1.7+ dojo bootstrap/loader operating in async mode
						false,

					sandbox = 
						// boolean; use a loader configuration that sandboxes the dojo and dojox objects used by doh
						false,

					trim= function(text){
						if(text instanceof Array){
							for (var result= [], i= 0; i<text.length; i++) {
								result.push(trim(text[i]));
							}
							return result;
						}else{
							return text.match(/[^\s]*/)[0]; 
						}
					}

					qstr = window.location.search.substr(1);

				if(qstr.length){
					for(var qparts= qstr.split("&"), x= 0; x<qparts.length; x++){
						var tp = qparts[x].split("="), name=tp[0], value=(tp[1]||"").replace(/[<>"':\(\)]/g, ""); // replace() to avoid XSS attack
						//Avoid URLs that use the same protocol but on other domains, for security reasons.
						if (value.indexOf("//") === 0 || value.indexOf("\\\\") === 0) {
							throw "Insupported URL";
						}
						switch(name){
							// Note:
							//	 * dojoUrl is deprecated, and is a synonym for boot
							//	 * testUrl is deprecated, and is a synonym for test
							//	 * testModule is deprecated, and is a synonym for test (dots are automatically replaced with slashes)
							//	 * registerModulePath is deprecated, and is a synonym for paths
							case "boot":
							case "dojoUrl":
								boot= trim(value.split(","));
								break;
			
							case "test":
							case "testUrl":
								test= trim(value.split(","));
								break;
			
							case "testModule":
								test= trim(value.replace(/\./g, "/").split(","));
								break;
			
							// registerModulePath is deprecated; use "paths"
							case "registerModulePath":
							case "paths":
								for(var path, modules = value.split(";"), i= 0; i<modules.length; i++){
									path= modules[i].split(",");
									paths[trim(path[0])]= trim(path[1]);
								}
								break;

							case "breakOnError":
								breakOnError= true;
								break;

							case "sandbox":
								sandbox= true;
								break;

							case "async":
								async= true;
								break;
							case "dohPlugins":
								dohPlugins=value.split(";");
								break;
						}
					}
				}

				function fixHeight(dojo){
					// IE9 doesn't give test iframe height because no nodes have an explicit pixel height!
					// Give outer table a pixel height.
					if(dojo.isIE){
						var headerHeight=0;
						var rows=dojo.query('#testLayout > tbody > tr');
						for(var i=0; i<rows.length-1; i++){
							headerHeight+=dojo.position(rows[i]).h;
						}
						try{
							// we subtract the headerHeight from the window height because the table row containing the tests is height:100% so they will stretch the table to the intended height.
							dojo.byId('testLayout').style.height=(dojo.window.getBox().h-headerHeight)+"px";
						}catch(e){
							// An obscure race condition when you load the runner in IE from the command line causes the window reported height to be 0.
							// Try to recover after the window finishes rendering.
							setTimeout(function(){ fixHeight(dojo); },0);
						}
					}
				}

				var config;
				if(sandbox){
					// configure the loader assuming the dojo loader; of course the injected boot(s) can override this config
					config= {
						// this config uses the dojo loader's scoping features to sandbox the version of dojo used by doh
						packages:[{
							name:'doh',
							location:'../util/doh',
							// here's the magic...everytime doh asks for a "dojo" module, it gets mapped to a "dohDojo"
							// module; same goes for dojox/dohDojox since doh uses dojox
							packageMap:{dojo:"dohDojo", dojox:"dohDojox"} 
						},{
							// now define the dohDojo package...
							name:'dohDojo',
							location:'../dojo'
						},{
							// and the dohDojox package...
							name:'dohDojox',
							location:'../dojox',
							// and dojox uses dojo...that is, dohDojox...which must be mapped to dohDojo in the context of dohDojox
							packageMap:{dojo:"dohDojo"} 
						}],
						
						// next, we need to preposition a special configuration for dohDojo
						cache:{
							"dohDojo*_base/config":function(){
								define([], {
									// this configuration keeps dojo, dijit, and dojox out of the global space
									scopeMap:[["dojo", "dohDojo"], ["dijit", "dohDijit"], ["dojox", "dohDojox"]],
									isDebug:true,
									noGlobals:true
								});
							}
						},
	
						// control the loader; don't boot global dojo, doh will ask for dojo itself
						has:{
							"dojo-sniff":0,
							"dojo-loader":1,
							"dojo-boot":0,
							"dojo-test-sniff":1
						},
	
						// no sniffing; therefore, set the baseUrl
						baseUrl:"../../dojo",
	
						deps:["dohDojo", "doh", "dohDojo/window"],

						callback:function(dohDojo, doh){
							dohDojo.ready(function(){
								fixHeight(dohDojo);
								doh.breakOnError= breakOnError;
								require(test);
								dohDojo.ready(doh, "run");
							});
						},

						async:async
					};
				}else{
					config= {
						deps:["dojo", "doh", "dojo/window"],
						callback:function(dojo, doh){
							dojo.ready(function(){
								fixHeight(dojo);
								doh.breakOnError= breakOnError;
								require(test);
								dojo.ready(doh, "run");
							});
						},
						async:async,
						isDebug:1
					};
				}
				
				// load all of the dohPlugins
				if(dohPlugins){
					var i=0;
					for(i=0; i<dohPlugins.length; i++){
						config.deps.push(dohPlugins[i]);
					}
				}
				
				require= config;

				// now script inject any boots
				for(var e, i= 0; i<boot.length; i++) {
					if(boot[i]){
						e= document.createElement("script");
						e.type= "text/javascript";
						e.src= boot[i];
						e.charset= "utf-8";
						document.getElementsByTagName("head")[0].appendChild(e);
					}
				}
			})()
		</script>
	
		<style type="text/css">
			@import "../../dojo/resources/dojo.css";
			/*
			body {
				margin: 0px;
				padding: 0px;
				font-size: 13px;
				color: #292929;
				font-family: Myriad, Lucida Grande, Bitstream Vera Sans, Arial, Helvetica, sans-serif;
				*font-size: small;
				*font: x-small;
			}

			th, td {
				font-size: 13px;
				color: #292929;
				font-family: Myriad, Lucida Grande, Bitstream Vera Sans, Arial, Helvetica, sans-serif;
				font-weight: normal;
			}

			* body {
				line-height: 1.25em;
			}
			
			table {
				border-collapse: collapse;
			}
			*/

			#testLayout {
				position: relative;
				left: 0px;
				top: 0px;
				width: 100%;
				height: 100%;
				border: 1px solid black;
				border: 0px;
			}

			.tabBody {
				margin: 0px;
				padding: 0px;
				/*
				border: 1px solid black;
				*/
				background-color: #DEDEDE;
				border: 0px;
				width: 100%;
				height: 100%;
				position: absolute;
				left: 0px; 
				top: 0px;
				overflow: auto;
			}

			#logBody {
				padding-left: 5px;
				padding-top: 5px;
				font-family: Monaco, monospace;
				font-size: 11px;
				white-space: pre;
			}

			#progressOuter {
				background:#e9e9e9 url("http://o.aolcdn.com/dojo/1.3/dijit/themes/tundra/images/dojoTundraGradientBg.png") repeat-x 0 0;
				height: 1em;
				/*the following trick is necessary to prevent IE from wrapping the last piece of progress bar into a new line*/
				_margin:1px;
				_padding: -1px;
				
				/*
				border-color: #e8e8e8;
				*/
			}

			#progressOuter .success, #progressOuter .failure{
				float: left;
				height: 1em;
			}

			#play, #pause {
				font-family: Arial;
				font-size: 1.4em;
				border: 1px solid #DEDEDE;
				cursor: pointer;
				padding-right: 0.5em;
			}

			.header {
				border: 1px solid #DEDEDE;
			}

			button.tab {
				border-width: 1px 1px 0px 1px;
				border-style: solid;
				border-color: #DEDEDE;
				margin-right: 5px;
			}

			#testListContainer {
				/*
				border: 1px solid black;
				*/
				position: relative;
				height: 99%;
				width: 100%;
				overflow: auto;
			}

			#testList {
				border-collapse: collapse;
				position: absolute;
				left: 0px;
				width: 100%;
			}

			#testList td {
				border-bottom: 1px solid #DEDEDE;
				border-right : 1px solid #DEDEDE;
				padding: 3px;
			}

			#testListHeader th {
				border-bottom: 1px solid #DEDEDE;
				border-right : 1px solid #DEDEDE;
				padding: 3px;
				font-weight: bolder;
				font-style: italic;
			}
			
			#testList tfoot {
				font-weight: bold;
			}

			#toggleButtons {
				float: left;
				background-color: #DEDEDE;
			}

			div.testGroupName {
				position: absolute;
			}

			.inProgress {
				background-color: #85afde;
			}

			.success {
				background-color: #7cdea7;
			}

			.failure {
				background-color: #de827b;
			}
		</style>
	</head>
	<body style="height: 100%;">
		<table id="testLayout" cellpadding="0" cellspacing="0" style="margin: 0;">
			<tr valign="top" height="40">
				<td colspan="2" id="logoBar">
					<h3 style="margin: 5px 5px 0px 5px; float: left;">D.O.H.: The Dojo Objective Harness</h3>
					<img src="small_logo.png" height="40" style="margin: 0px 5px 0px 5px; float: right;">
					<span style="margin: 10px 5px 0px 5px; float: right;">
						<input type="checkbox" id="audio" name="audio">
						<label for="audio">sounds?</label>
					</span>
				</td>
			</tr>
			<tr valign="top" height="10">
				<td colspan="2"><div id="progressOuter" onclick="doh._jumpToSuite(arguments[0]);"></div></td>
			</tr>
			<tr valign="top" height="30">
				<td width="30%" class="header">
					<span id="toggleButtons" onclick="doh.togglePaused();">
						<button id="play">&#9658;</button>
						<button id="pause" style="display: none;">&#9553;</button>
					</span>
					<span id="runningStatus">
						<span id="pausedMsg">Stopped</span>
						<span id="playingMsg" style="display: none;">Tests Running</span>
					</span>
				</td>
				<td width="*" class="header" valign="bottom">
					<button class="tab" onclick="doh.showTestPage();">Test Page</button>
					<button class="tab" onclick="doh.showLogPage();">Log</button>
										<button class="tab" onclick="doh.showPerfTestsPage();">Performance Tests Results</button>
				</td>
			</tr>
			<tr valign="top" style="border: 0; padding: 0; margin: 0;">
				<td style="border: 0; padding: 0; margin: 0; height:100%;">
					<div id="testListContainer">
						<table cellpadding="0" cellspacing="0" border="0"
							width="100%" id="testList" style="margin: 0;" onclick="doh._jumpToLog(arguments[0]);">
							<thead>
								<tr id="testListHeader" style="border: 0; padding: 0; margin: 0;" >
									<th>&nbsp;</th>
									<th width="20">
										<input type="checkbox" checked 
											onclick="doh.toggleRunAll();">
									</th>
									<th width="*" style="text-align: left;">test</th>
									<th width="50">time</th>
								</tr>
							</thead>
							<tbody valign="top">
								<tr id="groupTemplate" style="display: none;">
									<td style="font-family: Arial; width: 15px;">&#9658;</td>
									<td>
										<input type="checkbox" checked>
									</td>
									<td>group name</td>
									<td>10ms</td>
								</tr>
								<tr id="testTemplate" style="display: none;">
									<td>&nbsp;</td>
									<td>&nbsp;</td>
									<td style="padding-left: 20px;">test name</td>
									<td>10ms</td>
								</tr>
							</tbody>
						</table>
					</div>
				</td>
				<td style="height: 100%;">
					<div style="position: relative; width: 100%; height: 100%; top: 0px; left: 0px;">
						<div class="tabBody"
							style="z-index: 1;">
							<pre id="logBody"></pre>
							<div id="perfTestsBody" style="background-color: white;"></div>
						</div>
						<iframe id="testBody" class="tabBody"
							style="z-index: -1;"></iframe>
						<!--
							src="http://redesign.dojotoolkit.org"></iframe>
						-->
					</div>
				</td>
			</tr>
		</table>
		<span id="hiddenAudio"></span>
	</body>
</html>

