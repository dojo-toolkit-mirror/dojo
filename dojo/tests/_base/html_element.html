<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN"
	"http://www.w3.org/TR/html4/strict.dtd">
<!--
	we use a strict-mode DTD to ensure that the box model is the same for these
	basic tests
-->
<html>
	<head>
		<title>testing Core HTML/DOM/CSS/Style utils</title>
		<style type="text/css">
			@import "../../resources/dojo.css";
		</style>
		<script type="text/javascript" 
			src="../../dojo.js" 
			djConfig="isDebug: true"></script>
		<script type="text/javascript">
			dojo.require("doh.runner");
			
			dojo.addOnLoad(function(){
				doh.register("t", 
					[
					
						function createBasic(t){
							// test plain creation
							var n = dojo.create("div");
							dojo.byId("holder1").appendChild(n);
							dojo.addClass(n, "testing");
							var q = dojo.query(".testing");
							
							doh.is(1, q.length);
							doh.is("div", n.nodeName.toLowerCase());
						},
						
						function createAttrs(t){
							// test attr creation, no placement
							var n = dojo.create('div', {
								"class":"hasClass",
								title:"foo",
								style:"border:2px solid #ededed; padding:3px"
							});
							// plain placement:
							dojo.byId("holder1").appendChild(n);
							
							doh.t(dojo.hasClass(n, "hasClass"));
							doh.is("foo", dojo.attr(n, "title"));
							//FIXME: apparently attr(n, "style", "foo:bar; baz:bam;") doesn't work in IE?
							// need to test further in attr or document.
							//doh.is(3, dojo.style(n, "padding"));
						},
						
						function createPlace(t){
							// test only creation and placement, no attr
							var n = dojo.create("div", null, dojo.body());
							n.innerHTML = "<p class='bar'>a</p>";
							var q = dojo.query("p", n);
							
							doh.is(1, q.length);
							doh.t(dojo.hasClass(q[0], "bar"));
						},
						
						function createHtml(t){
							// test creation, placement, and attr (innerHTML)
							var n = dojo.create("div", {
								innerHTML: "<p class='bar2'>a</p>"
							}, dojo.body());
							var q = dojo.query("p", n);
							
							doh.is(1, q.length);
							doh.t(dojo.hasClass(q[0], "bar2"));
						},
						
						function createPlaceRef(t){
							// test creation and referenced placement, with some attr
							var ref = dojo.query("#holder2 > li.last")[0];
							
							var n = dojo.create("li", { 
								innerHTML:"middle", "class":"middleNode"
							}, ref, "before");
							
							doh.is(3, dojo.query("#holder2 li").length);
							
							var nn = dojo.create("li", { 
								innerHTML:"afterLast", "class":"afterLast"
							}, ref, "after");
							
							// FIXME: this is dependant on query() retaining DOM order. 
							//		is that safe? nextSibling and friends are a PITA
							var classes = ["first", "middleNode", "last", "afterLast"];
							var q = dojo.query("#holder2 li");
							doh.is(4, q.length);
							
							q.forEach(function(n, i){
								doh.is(classes[i], n.className);
							});
							
						},
						
						function destroyList(t){
							// destroy node byId
							dojo.destroy("holder2");
							doh.f(dojo.byId("holder2"));
							// destroyed because is child of holder
							doh.is(0, dojo.query(".first").length);
						},
						
						function createList(t){
							// test creation/placement of a variety of node tags
							var es = ["div", "a", "span", "br", "table", "ul", "dd", "img", "h2"];
							dojo.forEach(es, function(el){
								dojo.create(el, null, "holder3");
							});
							var q = dojo.query(">", "holder3");
							doh.is(q.length, es.length);
							
							// destroy this list:
							q.forEach(dojo.destroy);
							q = dojo.query(">", "holder3");
							doh.is(q.length, 0);
							
						},
						
						function destroyAll(t){
							var c = function(){
								// eg: don't destroy firebug lite in page
								return dojo.query("body >").filter(function(n){
									return !dojo.hasClass(n, "firebug");
								})
							}
							c().forEach(dojo.destroy);

							// check for deepest embeeded id
							doh.f(dojo.byId("ancFoo"));
							doh.is(0, c().length);
						},
						
						function recreateOne(t){
							var n = dojo.create("h2", {
								"class":"restored",
								innerHTML:"<span>The End</span>"
							}, dojo.body());
							
							doh.is(1, dojo.query(".restored").length);
						}
						
					]
				);
				doh.run();
			});
		</script>
	</head>
	<body>
		<h1>testing Core DOM utils</h1>
		
		<div id="holder1"></div>
		<ul id="holder2">
			<li class="first">first</li>
			<li class="last">last</li>
		</ul>
		
		<div id="holder3"></div>
		
		<p id="someId"></p>
		
		<div>
			<div>
				<a id="ancFoo" href="null.html">link</a>
			</div>
		</div>
		
	</body>
</html>

